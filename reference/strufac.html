<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calculation of structure factors for any input reflection"><title>Calculation of structure factors — strufac • cry</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculation of structure factors — strufac"><meta property="og:description" content="Calculation of structure factors for any input reflection"><meta property="og:image" content="https://jfoadi.github.io/cry/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cry</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MTZ.html">Read and analyse an MTZ file</a>
    <a class="dropdown-item" href="../articles/SHELX.html">Read SHELXC/D/E log file</a>
    <a class="dropdown-item" href="../articles/XDS.html">Read and analyse an XDS file</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculation of structure factors</h1>
      
      <div class="d-none name"><code>strufac.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculation of structure factors for any input reflection</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">strufac</span><span class="op">(</span><span class="va">hkl</span>, <span class="va">xyzf</span>, <span class="va">aname</span>, <span class="va">B</span>, <span class="va">Occ</span>, <span class="va">SG</span>, <span class="va">cpars</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>hkl</dt>
<dd><p>An m X 3 array or data frame of integers. Each row is a set
of Miller indices, \((h,k,l)\).</p></dd>


<dt>xyzf</dt>
<dd><p>An n X 3 array or data frame whose rows are the fractional
coordinates of the n atoms in the asymmetric unit.</p></dd>


<dt>aname</dt>
<dd><p>A character string. The name of the atomic species.</p></dd>


<dt>B</dt>
<dd><p>A vector of length n providing the thermal factor for the n
atoms in the asymmetric unit.</p></dd>


<dt>Occ</dt>
<dd><p>A vector of length n providing the occupancy numbers for the
n atoms in the asymmetric unit.</p></dd>


<dt>SG</dt>
<dd><p>A character string indicating the extended
Hermann-Mauguin symbol for the space group.</p></dd>


<dt>cpars</dt>
<dd><p>A length-6 vector containing the unit cell parameters. The
first three numbers are a, b, c, the last three are the
angles \(\alpha, \beta, \gamma\) in degrees.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A named list with amplitudes (name "F") and phases in degrees
        (name "phi") of the structure factors calculated. Each component
        of the list is a vector of length equal to the number of input
        Miller indices.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The theoretical formula in P 1 for the calculation of a structure factor
with Miller indices \((h,k,l)\) is,
$$
  F(h,k,l) = \sum_{j=1}^N Occ_j f_j(s)\exp(-B_j s^2/4)
  \exp(2\pi\mathrm{i}(hx_j+ky_j+lz_j))
$$
where \(B_j\) is the B factor for atom j, \(s=|\mathbf{h}|\),
\(f_j\) is the scattering factor for atom j and \(Occ_j\) is the
occupancy for atom j.
When a symmetry is present, only the atoms in the asymmetric unit are
necessary as they are expanded into a P 1 structure using symmetry
operators. The specific symmetry will be reflected in amplitude and
phase of specific structure factors having precise values (e.g. 0, 90,
180, etc) or being zero (systematic absences).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Random 5-atom structure in P 21 21 21</span></span></span>
<span class="r-in"><span><span class="co"># Asymmetric unit is 0 &lt; x &lt; 1/4, 0 &lt; y &lt; 1, 0 &lt; z &lt; 1</span></span></span>
<span class="r-in"><span><span class="va">xyzf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>,min<span class="op">=</span><span class="fl">0</span>,max<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>,min<span class="op">=</span><span class="fl">0</span>,max<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>,min<span class="op">=</span><span class="fl">0</span>,max<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Atoms are C, N, O, F, Fe</span></span></span>
<span class="r-in"><span><span class="va">aname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="st">"N"</span>,<span class="st">"O"</span>,<span class="st">"F"</span>,<span class="st">"Fe"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Random B factors around 1</span></span></span>
<span class="r-in"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span>,mean<span class="op">=</span><span class="fl">1</span>,sd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># No atoms in special position</span></span></span>
<span class="r-in"><span><span class="va">Occ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,times<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Space group xHM symbol</span></span></span>
<span class="r-in"><span><span class="va">SG</span> <span class="op">&lt;-</span> <span class="st">"P 21 21 21"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Cell parameters</span></span></span>
<span class="r-in"><span><span class="va">cpars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">90</span>,<span class="fl">90</span>,<span class="fl">90</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a few Miller indices</span></span></span>
<span class="r-in"><span><span class="va">hkl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span>,k<span class="op">=</span><span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span>,l<span class="op">=</span><span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Creation of structure factors</span></span></span>
<span class="r-in"><span><span class="va">lSF</span> <span class="op">&lt;-</span> <span class="fu">strufac</span><span class="op">(</span><span class="va">hkl</span>,<span class="va">xyzf</span>,<span class="va">aname</span>,<span class="va">B</span>,<span class="va">Occ</span>,<span class="va">SG</span>,<span class="va">cpars</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in strufac(hkl, xyzf, aname, B, Occ, SG, cpars):</span> could not find function "strufac"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check systematic absences (give lSF$F = 0)</span></span></span>
<span class="r-in"><span><span class="co"># For P 21 21 21 they are:</span></span></span>
<span class="r-in"><span><span class="co"># (h,0,0),h=2n</span></span></span>
<span class="r-in"><span><span class="co"># (0,k,0),k=2n</span></span></span>
<span class="r-in"><span><span class="co"># (0,0,l),l=2n</span></span></span>
<span class="r-in"><span><span class="va">fullidx</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">125</span></span></span>
<span class="r-in"><span><span class="va">jdx</span> <span class="op">&lt;-</span> <span class="fu"><a href="sysabs.html">sysabs</a></span><span class="op">(</span><span class="va">hkl</span>,<span class="va">SG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="va">fullidx</span><span class="op">[</span><span class="op">-</span><span class="va">jdx</span><span class="op">]</span>  <span class="co"># These are the systematic absences</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hkl</span><span class="op">[</span><span class="va">idx</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     h  k  l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38  0  0 -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 58  0 -1  0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 62 -1  0  0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 64  1  0  0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 68  0  1  0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 88  0  0  1</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lSF</span><span class="op">$</span><span class="cn">F</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in print(lSF$F[idx]):</span> object 'lSF' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now check reflections with (h,k,0). h even has phase 0,180</span></span></span>
<span class="r-in"><span><span class="co"># and h odd has phase 90,270</span></span></span>
<span class="r-in"><span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">hkl</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lSF</span><span class="op">$</span><span class="va">phi</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in print(lSF$phi[idx]):</span> object 'lSF' not found</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by James Foadi, David Waterman, Rita Giordano, Kutumbarao Nidamarthi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

